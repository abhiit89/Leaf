<script type="text/javascript">
	var root = window.IssueTracker || (window.IssueTracker = {});
	root.selectedIssue = IssueTracker.Utilities.createPropertyObservables({{{issue}}});
</script>

<div class="container notop details-header">
	<div class="breadcrumbs">
		<a class="clickable" data-bind="attr: { href: '#/issues' }">
			<i class="fa fa-home"></i>
			<span data-bind="text: IssueTracker.projectName"></span>
		</a>
		<i class="fa fa-angle-right"></i>
		<a>
			<span data-bind="text: 'Issue #' + IssueTracker.selectedIssue.number()"></span>
		</a>
	</div>

	<div class="issue-buttons">
		<img id="transition-loader" class="hidden" src="/images/ajax-loader.gif" alt="" data-bind="css: { hidden: !IssueTracker.Transitioner.transitioning() }" />
		<div class="transitions" data-bind="visible: IssueTracker.selectedIssue.transitions().length > 0, foreach: IssueTracker.selectedIssue.transitions">
            <button class="icon" data-bind="attr: { 'data-status-id': toId, disabled: IssueTracker.Transitioner.transitioning }">
                <span data-bind="text: name"></span>
                <i class="fa fa-angle-right"></i>
            </button>
		</div>
		<div class="always">
			<button class="round" id="save-changes" data-bind="visible: IssueTracker.isAuthorized('edit-issue'), css: { loading: saving }">
				<i class="fa fa-check"></i>
				<img src="../images/light-spinner.png" alt="" />
			</button>
			<button class="round" data-bind="click: Files.upload, css: { loading: Files.uploading }">
				<i class="fa fa-paperclip"></i>
				<img src="../images/light-spinner.png" alt="" />
			</button>
			<button class="round" data-bind="click: Delete.restore, visible: IssueTracker.isAuthorized('delete-issue') && IssueTracker.selectedIssue.isDeleted(), css: { loading: Delete.loading }">
				<i class="fa fa-trash-o"></i>
				<img src="../images/light-spinner.png" alt="" />
			</button>
			<button class="round" data-bind="click: Delete.remove, visible: IssueTracker.isAuthorized('delete-issue') && !IssueTracker.selectedIssue.isDeleted()">
				<i class="fa fa-trash-o"></i>
				<img src="../images/light-spinner.png" alt="" />
			</button>
		</div>
	</div>
</div>

<div class="container name-and-number-wrapper">
	<div class="name-container perspective" data-bind="style: { 'border-left-color': IssueTracker.Utilities.getPriorityColour(IssueTracker.selectedIssue.priorityId()) }">
		<div class="description">
			<input id="description" type="text" class="description no-focus" data-bind="enable: IssueTracker.isAuthorized('edit-issue'), value: IssueTracker.selectedIssue.description" />
		</div>
	</div>
</div>
	
<div class="content">
	<textarea id="details" placeholder="Details..." class="no-focus" data-bind="enable: IssueTracker.isAuthorized('edit-issue'), value: IssueTracker.selectedIssue.details"></textarea>

	<div class="detailed-info">
		<div class="milestone padded-tile-container">
			<div class="tile label">
				<label>Milestone</label>
				<span data-bind="text: IssueTracker.selectedIssue.milestone"></span>
				<i class="fa fa-angle-down"></i>
			</div>
			<div class="tile choice-tile scroll">
				<!-- ko foreach: IssueTracker.milestones -->
				<div data-bind="attr: { 'data-id': id }, css: { selected: IssueTracker.selectedIssue.milestoneId() == id() }, click: function() { IssueTracker.selectedIssue.milestoneId(id()); }">
					<span data-bind="text: name"></span>
					<i class="fa fa-check"></i>
				</div>
				<!-- /ko -->
			</div>
		</div>
		<div class="priority padded-tile-container">
			<div class="tile label">
				<label>Priority</label>
				<span data-bind="text: IssueTracker.selectedIssue.priority"></span>
				<i class="fa fa-angle-down"></i>
			</div>
			<div class="tile choice-tile scroll">
				<!-- ko foreach: IssueTracker.priorities -->
				<div data-bind="attr: { 'data-id': id }, css: { selected: IssueTracker.selectedIssue.priorityId() == id() }, click: function() { IssueTracker.selectedIssue.priorityId(id()); }">
					<span data-bind="text: name"></span>
					<i class="fa fa-check"></i>
				</div>
				<!-- /ko -->
			</div>
		</div>
		<div class="status padded-tile-container">
			<div class="tile label">
				<label>Status</label>
				<span data-bind="text: IssueTracker.selectedIssue.status"></span>
				<i class="fa fa-angle-down"></i>
			</div>
			<div class="tile choice-tile scroll">
				<!-- ko foreach: IssueTracker.statuses -->
				<div data-bind="attr: { 'data-id': id }, css: { selected: IssueTracker.selectedIssue.statusId() == id() }, click: function() { IssueTracker.selectedIssue.statusId(id()); }">
					<span data-bind="text: name"></span>
					<i class="fa fa-check"></i>
				</div>
				<!-- /ko -->
			</div>
		</div>
		<div class="type padded-tile-container">
			<div class="tile label">
				<label>Type</label>
				<span data-bind="text: IssueTracker.selectedIssue.type"></span>
				<i class="fa fa-angle-down"></i>
			</div>
			<div class="tile choice-tile scroll">
				<!-- ko foreach: IssueTracker.issueTypes -->
				<div data-bind="attr: { 'data-id': id }, css: { selected: IssueTracker.selectedIssue.typeId() == id() }, click: function() { IssueTracker.selectedIssue.typeId(id()); }">
					<span data-bind="text: name"></span>
					<i class="fa fa-check"></i>
				</div>
				<!-- /ko -->
			</div>
		</div>
		<div class="developer padded-tile-container">
			<div class="tile label">
				<label>Developer</label>
				<span data-bind="text: IssueTracker.selectedIssue.developer"></span>
				<i class="fa fa-angle-down"></i>
			</div>
			<div class="tile choice-tile scroll">
				<!-- ko foreach: IssueTracker.users -->
				<!-- ko if: !isDeleted() -->
				<div data-bind="attr: { 'data-id': id }, css: { selected: IssueTracker.selectedIssue.developerId() == id() }, click: function() { IssueTracker.selectedIssue.developerId(id()); }">
					<span data-bind="text: name"></span>
					<i class="fa fa-check"></i>
				</div>
				<!-- /ko -->
				<!-- /ko -->
			</div>
		</div>
		<div class="tester padded-tile-container">
			<div class="tile label">
				<label>Tester</label>
				<span data-bind="text: IssueTracker.selectedIssue.tester"></span>
				<i class="fa fa-angle-down"></i>
			</div>
			<div class="tile choice-tile scroll">
				<!-- ko foreach: IssueTracker.users -->
				<!-- ko if: !isDeleted() -->
				<div data-bind="attr: { 'data-id': id }, css: { selected: IssueTracker.selectedIssue.testerId() == id() }, click: function() { IssueTracker.selectedIssue.testerId(id()); }">
					<span data-bind="text: name"></span>
					<i class="fa fa-check"></i>
				</div>
				<!-- /ko -->
				<!-- /ko -->
			</div>
		</div>
	</div>

	<div class="comments">
		<div class="new-comment" data-bind="visible: IssueTracker.isAuthorized('edit-issue')">
			<div>
                <div class="comment-header">
                    <div class="upi">
                        <img class="user-profile-image" data-bind="attr: { src: IssueTracker.Utilities.getUserProfileImageLocation(null, 25) }" alt="" />
                        <span></span>
                    </div>
                    <span class="name" data-bind="text: IssueTracker.signedInUser() ? IssueTracker.signedInUser().name : ''"></span>
                </div>
				<textarea class="no-focus" placeholder="Add a comment..." data-bind="value: Comments.text"></textarea>
			</div>
		</div>
		<!-- ko foreach: { data: Comments.comments, afterAdd: Comments.slideDown } -->
			<div>
				<div>
					<div class="comment-header">
						<div class="upi">
							<img class="user-profile-image" data-bind="attr: { src: IssueTracker.Utilities.getUserProfileImageLocation(userId, 25) }" alt="" />
							<span></span>
						</div>
						<span class="name" data-bind="text: user"></span>
						<span class="date" data-bind="text: date"></span>
						<!-- ko if: $root.Comments.isOwner($data) -->
						<i class="fa fa-trash-o" title="Delete Comment" data-bind="click: $root.Comments.remove"></i>
						<!-- /ko -->
					</div>
					<div class="text">
						<div class="scroll" data-bind="html: text"></div>
					</div>
				</div>
			</div>
		<!-- /ko -->
	</div>
</div>

<script type="text/html" id="confirm-delete">
	<div class="confirm-delete form">
		<h1>Delete this issue?</h1>
		<span>Deleting an issue is 100% reversible; we only mark it as deleted. In the event you delete this issue by mistake or need to restore it later, no problem; you can search for the issue and undelete it that way. Are you sure you want to continue?</span>
		<div class="button-container">
			<button class="round" data-bind="click: IssueTracker.IssueDetails.Delete.cancel">
				<i class="fa fa-times"></i>
			</button>
			<button class="round" data-bind="click: IssueTracker.IssueDetails.Delete.confirm, css: { loading: loading }">
				<i class="fa fa-check"></i>
				<img src="../images/light-spinner.png" alt="" />
			</button>
		</div>
	</div>
</script>

<script type="text/html" id="confirm-delete-comment-template">
    <div class="confirm-delete form">
        <h1>Delete this comment?</h1>
        <span class="warning"><b>WARNING:</b> This action is irreversible.</span>
        <span>Once deleted, the comment will be removed from our databases. Are you sure you want to continue?</span>
        <div class="button-container">
			<button id="cancel-delete-comment" data-bind="click: cancel">
				<i class="fa fa-times"></i>
			</button>
            <button id="confirm-delete-comment" data-bind="css: { loading: loading }, click: confirm">
				<i class="fa fa-check"></i>
				<img src="../images/light-spinner.png" alt="" />
            </button>
        </div>
    </div>
</script>