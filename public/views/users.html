<script type="text/javascript">
	$(function() {
		var root = IssueTracker.Users;
		root.users = ko.observableArray([]);
		$.each({{{users}}}, function(i, user) {
			root.users.push(IssueTracker.Utilities.createPropertyObservables(user));
		});
	});
</script>

<div class="page-actions">
	<button class="icon create-user-trigger" data-bind="click: Create.create">
		<i class="fa fa-plus"></i>
		<span>Create User</span>
	</button>
</div>

<div class="users-container" data-bind="foreach: users">
    <!-- ko if: !isDeleted() -->
    <a class="tile">
        <img class="user-profile-image" data-bind="attr: { title: name, src: IssueTracker.Utilities.getUserProfileImageLocation(id()) }" alt="" />
        <span class="name" data-bind="text: name"></span>
        <span class="email" data-bind="text: emailAddress"></span>
        <div class="actions">
            <i class="fa fa-fw fa-lock" title="Reset Password" data-bind="click: $parent.ResetPassword.reset"></i>
            <i class="fa fa-fw fa-trash-o" title="Delete User" data-bind="click: $parent.DeleteUser.remove"></i>
            <i class="fa fa-fw fa-pencil" title="Edit User" data-bind="click: $parent.EditUser.edit"></i>
        </div>
        <div class="counts">
            <div>
                <i class="fa fa-code"></i>
                <span data-bind="text: developerIssueCount"></span>
            </div>
            <div>
                <i class="fa fa-flask"></i>
                <span data-bind="text: testerIssueCount"></span>
            </div>
        </div>
    </a>
    <!-- /ko -->
</div>

<div class="users-container deleted" data-bind="foreach: users">
    <!-- ko if: isDeleted() -->
    <a class="tile" data-bind="click: $root.Undelete.restore">
        <img class="user-profile-image" data-bind="attr: { title: name, src: IssueTracker.Utilities.getUserProfileImageLocation(id()) }" alt="" />
        <span class="name" data-bind="text: name"></span>
        <span class="email" data-bind="text: emailAddress"></span>
        <div class="actions">
            <i class="fa fa-fw fa-key" title="Reset Password" data-bind="click: $parent.ResetPassword.reset"></i>
            <i class="fa fa-fw fa-trash-o" title="Delete User" data-bind="click: $parent.DeleteUser.remove"></i>
            <i class="fa fa-fw fa-pencil" title="Edit User" data-bind="click: $parent.EditUser.edit"></i>
        </div>
        <div class="counts">
            <div>
                <i class="fa fa-code"></i>
                <span data-bind="text: developerIssueCount"></span>
            </div>
            <div>
                <i class="fa fa-flask"></i>
                <span data-bind="text: testerIssueCount"></span>
            </div>
        </div>
    </a>
    <!-- /ko -->
</div>

<script type="text/html" id="confirm-reset-password-template">
	<div class="confirm-reset-password confirmation-dialog">
		<h1>Reset Password</h1>
		<span>Are you sure you want to reset <b data-bind="text: user().name"></b>'s password? An email will be sent to the user with instructions on how to reset their password.</span>
		<div class="confirm-container">
			<button data-bind="click: confirm, css: { loading: loading }">Reset Password</button>
		</div>
		<div>
			<button data-bind="click: cancel">Cancel</button>
		</div>
	</div>
</script>

<script type="text/html" id="confirm-delete-user-template">
	<div class="confirm-delete confirmation-dialog">
		<h1>Delete User?</h1>
		<span>Once deleted, <b data-bind="text: user().name"></b> will still be assigned to any issues he or she is currently assigned to, but won't be assignable to any new or existing issues. Are you sure you want to continue?</span>
		<div class="confirm-container">
			<button id="confirm-delete" data-bind="css: { loading: loading }, click: confirm">Delete User</button>
		</div>
		<div>
			<button id="cancel-delete" data-bind="click: cancel">Cancel</button>
		</div>
	</div>
</script>

<script type="text/html" id="confirm-undelete-user-template">
	<div class="confirm-undelete confirmation-dialog">
		<h1>Restore User?</h1>
		<span>Once restored, <b data-bind="text: user.name"></b> will be able to be assigned to new issues. Are you sure you want to continue?</span>
		<div class="confirm-container">
			<button data-bind="css: { loading: loading }, click: confirm">Restore User</button>
		</div>
		<div>
			<button data-bind="click: cancel">Cancel</button>
		</div>
	</div>
</script>

<script type="text/html" id="edit-user-template">
	<div class="edit-user form">
		<h1>Edit User</h1>
		<input type="text" placeholder="Name..." data-bind="value: user().name" />
		<input type="text" placeholder="Email address..." data-bind="value: user().emailAddress" />
		<div class="button-container first">
			<button data-bind="click: save, css: { loading: loading }">Save</button>
		</div>
		<div class="button-container">
			<button data-bind="click: cancel">Cancel</button>
		</div>
	</div>
</script>

<script type="text/html" id="create-user-template">
	<div class="create-user form">
		<h1>Create User</h1>
		<span>Once created, the new user will receive an email with instructions on how to activate his or her account.</span>
		<input type="text" placeholder="Name..." data-bind="value: user().name" />
		<input type="text" placeholder="Email address..." data-bind="value: user().emailAddress" />
		<div class="button-container first">
			<button data-bind="click: save, css: { loading: loading }">Save</button>
		</div>
		<div class="button-container">
			<button data-bind="click: cancel">Cancel</button>
		</div>
	</div>
</script>